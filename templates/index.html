<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <title>カロリー計算</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        .calculator-container { max-width: 800px; margin: auto; padding: 20px; }
        .user-info, .meals-grid { display: flex; flex-wrap: wrap; gap: 10px; margin-bottom: 20px; }
        .info-item, .meal-item { flex: 1 1 150px; display: flex; flex-direction: column; }
        button { padding: 10px 20px; }
        table { margin-top: 20px; border-collapse: collapse; }
    </style>
</head>
<body>

<div class="calculator-container">
    <h1>カロリー計算</h1>

    <div class="user-info">
        <div class="info-item">
            <label for="height">身長</label>
            <input type="number" id="height" name="height" placeholder="例: 170">
        </div>
        <div class="info-item">
            <label for="weight">体重</label>
            <input type="number" id="weight" name="weight" placeholder="例: 60">
        </div>
        <div class="info-item">
            <label for="age">年齢</label>
            <input type="number" id="age" name="age" placeholder="例: 20">
        </div>
        <div class="info-item">
            <label for="gender">性別</label>
            <select id="gender" name="gender">
                <option value="male">男性</option>
                <option value="female">女性</option>
            </select>
        </div>
    </div>

    <div class="meals-grid">
        
        <div class="meal-item">
            <label for="meal1">食事1</label>
            <select id="meal1" name="meal1"></select>
        </div>
        <div class="meal-item">
            <label for="meal2">食事2</label>
            <select id="meal2" name="meal2"></select>
        </div>
        <div class="meal-item">
            <label for="meal3">食事3</label>
            <select id="meal3" name="meal3"></select>
        </div>
        <div class="meal-item">
            <label for="meal4">食事4</label>
            <select id="meal4" name="meal4"></select>
        </div>
        <div class="meal-item">
            <label for="meal5">食事5</label>
            <select id="meal5" name="meal5"></select>
        </div>
        <div class="meal-item">
            <label for="meal6">食事6</label>
            <select id="meal6" name="meal6"></select>
        </div>
    </div>
    <button id="calculateBtn" type="button">計算する</button>

    <div id="resultArea"></div>
    <canvas id="radarChart" width="400" height="400"></canvas>
</div>

<script>
    document.addEventListener('DOMContentLoaded', function() {
        const genderMap = {
            "male": 1,
            "female": 2,
        };
        
        // 1. 食事の選択肢リストを定義
        const foodOptionsList = [
            { value: "none", text: "--- 選択してください ---" },
            { value: "辛みそ豚丼（小）", text: "辛みそ豚丼（小）" },
            { value: "辛みそ豚丼（中）", text: "辛みそ豚丼（中）" },
            { value: "辛みそ豚丼（大）", text: "辛みそ豚丼（大）" },
            { value: "ねぎとろ丼", text: "ねぎとろ丼" },
            { value: "ほっき貝カレー（小）", text: "ほっき貝カレー（小）" },
            { value: "ほっき貝カレー（中）", text: "ほっき貝カレー（中）" },
            { value: "ほっき貝カレー（大）", text: "ほっき貝カレー（大）" },
            { value: "カレーライス（小）", text: "カレーライス（小）" },
            { value: "カレーライス（中）", text: "カレーライス（中）" },
            { value: "カレーライス（大）", text: "カレーライス（大）" },
            { value: "さっぽろ味噌ラーメン", text: "さっぽろ味噌ラーメン" },
            { value: "さっぽろ味噌ラーメン（大）", text: "さっぽろ味噌ラーメン（大）" },
            { value: "醤油ラーメン", text: "醤油ラーメン" },
            { value: "醤油ラーメン（大）", text: "醤油ラーメン（大）" },
            { value: "かけうどん", text: "かけうどん" },
            { value: "かけうどん（大）", text: "かけうどん（大）" },
            { value: "かけそば", text: "かけそば" },
            { value: "かけそば（大）", text: "かけそば（大）" },
            { value: "かき揚げうどん", text: "かき揚げうどん" },
            { value: "かき揚げうどん（大）", text: "かき揚げうどん（大）" },
            { value: "かき揚げそば", text: "かき揚げそば" },
            { value: "かき揚げそば（大）", text: "かき揚げそば（大）" },
            { value: "肉野菜炒めプレート（中）", text: "肉野菜炒めプレート（中）" },
            { value: "肉野菜炒めプレート（小）", text: "肉野菜炒めプレート（小）" },
            { value: "肉野菜炒めプレート（大）", text: "肉野菜炒めプレート（大）" },
            { value: "ホッケ塩焼き", text: "ホッケ塩焼き" },
            { value: "揚げ鶏の香味ソース", text: "揚げ鶏の香味ソース" },
            { value: "桜姫鶏デミチーズメンチ", text: "桜姫鶏デミチーズメンチ" },
            { value: "ポーク生姜焼き", text: "ポーク生姜焼き" },
            { value: "ねぎ塩ハンバーグ", text: "ねぎ塩ハンバーグ" },
            { value: "ジャンボたらカツ", text: "ジャンボたらカツ" },
            { value: "さば味噌煮", text: "さば味噌煮" },
            { value: "辛旨豆腐", text: "辛旨豆腐" },
            { value: "かぼちゃとチーズの包み揚げ", text: "かぼちゃとチーズの包み揚げ" },
            { value: "明太子スパゲティサラダ", text: "明太子スパゲティサラダ" },
            { value: "揚げ餃子", text: "揚げ餃子" },
            { value: "薩摩ハーブ鶏のレバー煮", text: "薩摩ハーブ鶏のレバー煮" },
            { value: "オクラのお浸し", text: "オクラのお浸し" },
            { value: "野菜生活１００", text: "野菜生活１００" },
            { value: "温泉たまご", text: "温泉たまご" },
            { value: "ひじき煮", text: "ひじき煮" },
            { value: "煮卵", text: "煮卵" },
            { value: "ごろっと野菜のツナマヨサラダ", text: "ごろっと野菜のツナマヨサラダ" },
            { value: "ポテト＆コーンサラダ", text: "ポテト＆コーンサラダ" },
            { value: "ライス１３０ｇ（小）", text: "ライス１３０ｇ（小）" },
            { value: "ライス２００ｇ（中）", text: "ライス２００ｇ（中）" },
            { value: "ライス２７０ｇ（大）", text: "ライス２７０ｇ（大）" },
            { value: "麦ご飯１３０ｇ（小）", text: "麦ご飯１３０ｇ（小）" },
            { value: "麦ご飯２００ｇ（中）", text: "麦ご飯２００ｇ（中）" },
            { value: "麦ご飯２７０ｇ（大）", text: "麦ご飯２７０ｇ（大）" },
            { value: "味噌汁（豆腐・わかめ）", text: "味噌汁（豆腐・わかめ）" },
            { value: "豚汁", text: "豚汁" },
            { value: "フルーツミックスヨーグルト", text: "フルーツミックスヨーグルト" },
            { value: "ショコラケーキ", text: "ショコラケーキ" },
            { value: "モンブラン", text: "モンブラン" },
            { value: "抹茶きなこケーキ", text: "抹茶きなこケーキ" },
            { value: "十勝大福", text: "十勝大福" }
        ];

        // 2. リストから <option> タグのHTMLを生成
        let optionsHTML = '';
        foodOptionsList.forEach(function(food) {
            optionsHTML += `<option value="${food.value}">${food.text}</option>`;
        });
        const mealSelects = document.querySelectorAll('.meals-grid select');
        mealSelects.forEach(select => {
            select.innerHTML = optionsHTML;
        });
        // ボタン要素を取得
        const calculateButton = document.getElementById('calculateBtn');

        // ボタンがクリックされたときの処理を登録
        calculateButton.addEventListener('click', async function() {
            
            // 1. 身長・体重・年齢・性別の値を取得
            const height = parseFloat(document.getElementById('height').value);
            const weight = parseFloat(document.getElementById('weight').value);
            const age = parseFloat(document.getElementById('age').value);
            const genderNum = genderMap[document.getElementById('gender').value];

            // 2. 食事1〜6の値を取得 (個別に取得する場合)
            const meal1 = document.getElementById('meal1').value;
            const meal2 = document.getElementById('meal2').value;
            const meal3 = document.getElementById('meal3').value;
            const meal4 = document.getElementById('meal4').value;
            const meal5 = document.getElementById('meal5').value;
            const meal6 = document.getElementById('meal6').value;

            const requestData = {
                // ユーザー情報
                userInfo: {
                    height: height,
                    weight: weight,
                    age: age,
                    gender: genderNum
                },
                // 食事情報
                meals: {
                    meal1,
                    meal2,
                    meal3,
                    meal4,
                    meal5,
                    meal6
                }
            };
            
                const res = await fetch("http://127.0.0.1:5000/calculate", {
                    method: "POST",
                    headers: { "Content-Type": "application/json" },
                    body: JSON.stringify(requestData)
                });

                const data = await res.json();

             // 目安値
            const recommended = {
                energy: data.recommended.energy / 3,
                carbs: data.recommended.carbs / 3,
                fat: data.recommended.fat / 3,
                vitaminA: data.recommended.vitaminA / 3,
                vitaminB1: data.recommended.vitaminB1 / 3,
                salt: data.recommended.salt / 3,
                iron: data.recommended.iron / 3,  
            };

            const total = data.total;
            const chartlabels = ['carbs', 'fat', 'vitaminA', 'vitaminB1', 'salt', 'iron'];
            const ratio = chartlabels.map(label => total[label.toLowerCase()] / recommended[label.toLowerCase()]);

            // 結果表示（表形式）
            document.getElementById("resultArea").innerHTML = `
            <p>BMI: ${data.recommended.BMI}</p>
            <table border="1" cellpadding="4">
                <tr>
                    <th>栄養素</th>
                    <th>摂取量</th>
                    <th>推奨量</th>
                </tr>
                <tr>
                    <td>カロリー</td>
                    <td>${total.energy} kcal</td>
                    <td>${recommended.energy} kcal</td>
                </tr>
                <tr>
                    <td>炭水化物</td>
                    <td>${total.carbs} g</td>
                    <td>${recommended.carbs} g</td>
                </tr>
                <tr>
                    <td>脂質</td>
                    <td>${total.fat} g</td>
                    <td>${recommended.fat} g</td>
                </tr>
                <tr>
                    <td>ビタミンA</td>
                    <td>${data.vitaminA} ugRAE</td>
                    <td>${recommended.vitaminA} ugRAE</td>
                </tr>
                <tr>
                    <td>ビタミンB1</td>
                    <td>${data.vitaminB1} mg</td>
                    <td>${recommended.vitaminB1} mg</td>
                </tr>
                <tr>
                    <td>塩分</td>
                    <td>${data.salt} g</td>
                    <td>${recommended.salt} g</td>
                </tr>
                <tr>
                    <td>鉄</td>
                    <td>${data.iron} mg</td>
                    <td>${recommended.iron} mg</td>
                </tr>
            </table>
            `;
            
            // 前のチャートを破棄
            if (window.radarChart) window.radarChart.destroy();

            // 新しいチャート作成
            window.radarChart = new Chart(document.getElementById("radarChart"), {
                type: 'radar',
                data: {
                    labels: [ '炭水化物', '脂質', 'ビタミンA', 'ビタミンB1', '塩分', '鉄'],
                    datasets: [{
                        label: '目安比率 (1 = 目安値)',
                        data: ratio,
                        backgroundColor: 'rgba(54, 162, 235, 0.2)',
                        borderColor: 'rgba(54, 162, 235, 1)',
                        borderWidth: 2
                    }]
                },
                options: {
                    scales: { r: { beginAtZero: true, max: 2 } }
                }
            });
        });
    });
</script>

</body>
</html>
